# 项目愿景与需求

## 1. 项目背景

多租户配置化数据建模与报表平台是一个面向企业级用户的数据管理平台，旨在为中大型组织提供开箱即用的数据建模、ETL任务流编排、数据可视化看板等核心能力。平台采用多租户架构，支持多个组织/公司/项目在同一个平台上进行逻辑隔离的数据管理。

### 1.1 业务背景

随着企业数字化转型的深入，越来越多的组织需要：
- 灵活的数据建模能力，支持快速定义业务数据结构
- 可视化的ETL任务流编排，降低数据集成门槛
- 自助式的数据看板构建，提升数据分析效率
- 细粒度的权限控制，保障数据安全

传统的数据平台往往需要大量定制开发，成本高、周期长。本平台通过配置化的方式，让业务人员也能快速构建数据模型和报表，同时为技术人员提供强大的扩展能力。

## 2. 目标用户

### 2.1 平台管理员（Platform Admin）
- **职责**：管理平台全局用户、租户、审计日志
- **使用场景**：
  - 创建和管理租户
  - 管理平台级用户账号
  - 查看系统审计日志
  - 监控租户使用情况

### 2.2 租户管理员（Tenant Owner）
- **职责**：管理租户内的用户、角色、权限配置
- **使用场景**：
  - 管理租户内用户和角色
  - 配置资源权限（表、任务流、看板）
  - 配置行级/列级数据权限
  - 查看租户使用情况

### 2.3 数据建模师（Data Modeler）
- **职责**：创建和维护数据模型
- **使用场景**：
  - 创建表结构（维度表、事实表等）
  - 定义字段和数据类型
  - 配置表间关系
  - 管理表数据

### 2.4 数据工程师（Data Engineer）
- **职责**：构建和维护ETL任务流
- **使用场景**：
  - 设计数据抽取任务（HTTP API、MySQL、文件等）
  - 配置数据转换节点（过滤、聚合、Join、计算字段等）
  - 配置数据写入目标（内部表、外部API）
  - 监控任务流执行状态

### 2.5 数据分析师（Data Analyst）
- **职责**：构建数据看板和报表
- **使用场景**：
  - 创建数据集（绑定表、配置基础过滤）
  - 设计看板布局
  - 配置可视化组件（指标卡、图表、表格）
  - 查看和分析数据

### 2.6 业务用户（Business User）
- **职责**：查看数据看板和报表
- **使用场景**：
  - 查看有权限的看板
  - 查看表数据（受行/列权限限制）
  - 导出数据（如有权限）

## 3. 核心功能列表

### 3.1 平台后台（Platform Admin Console）

#### 3.1.1 用户管理
- 全局用户（GlobalUser）的创建、编辑、禁用/启用
- 用户列表查询、搜索、筛选
- 用户状态管理

#### 3.1.2 租户管理
- 租户（Tenant）的创建、编辑、启用/停用
- 租户列表查询、搜索、筛选

#### 3.1.3 租户成员管理
- 查看租户下的所有成员（TenantUser）
- 添加/移除租户成员
- 设置租户Owner
- 管理成员状态

#### 3.1.4 审计日志
- 记录平台级操作日志
- 日志查询和筛选

### 3.2 租户工作区（Tenant Workspace）

#### 3.2.1 建模模块（Modeling）
- **表格资源树**：支持文件夹和表的树形结构管理
- **表管理**：
  - 创建/编辑/删除表
  - 表类型分类（维度/事实/配置/其他）
  - 自动生成表编码（基于LLM）
- **字段管理**：
  - 创建/编辑/删除字段
  - 支持多种数据类型（string/int/float/decimal/bool/date/datetime等）
  - 自动生成字段编码（基于LLM）
  - 主键、必填、默认值配置
- **表数据管理**：
  - 数据查询（支持过滤、分页、排序）
  - 数据新增/编辑/删除
  - 受行级/列级权限控制

#### 3.2.2 任务流模块（Flows）
- **任务流资源树**：支持文件夹和任务流的树形结构管理
- **任务流编辑**：
  - DAG可视化编辑器
  - 节点类型：Source（HTTP API、MySQL、文件）、Transform（选择/重命名、过滤、聚合、Join、计算字段）、Sink（写入内部表、写入HTTP API）
  - 节点配置面板
- **任务流管理**：
  - 创建/编辑/删除任务流
  - 调度配置（手动/CRON）
  - 手动触发执行
- **运行记录**：
  - 查看任务流执行历史
  - 查看节点执行详情（状态、耗时、输入/输出条数、错误信息）

#### 3.2.3 数据集与看板模块（Datasets & Boards）
- **数据集管理**：
  - 创建/编辑/删除数据集
  - 绑定表、配置基础过滤条件
- **看板资源树**：支持文件夹和看板的树形结构管理
- **看板编辑**：
  - 可视化布局编辑器（支持拖拽）
  - 组件类型：指标卡（MetricCard）、图表（Chart）、表格（Table）
  - 组件配置（数据集选择、查询配置、可视化配置）
- **看板查看**：
  - 实时数据展示
  - 受权限控制的数据访问

#### 3.2.4 系统设置（Settings）
- **租户用户管理**：
  - 查看租户内用户列表
  - 编辑用户角色
  - 启用/禁用用户（租户内）
- **角色管理**：
  - 创建/编辑/删除角色
  - 系统内置角色保护
- **权限配置**：
  - 资源级权限（表结构/表数据/任务流/看板）
  - 列级权限（HIDDEN/READONLY/READWRITE）
  - 行级权限（基于JSON DSL的过滤规则）

### 3.3 核心能力

#### 3.3.1 多租户隔离
- 所有业务数据按租户隔离
- 租户间数据完全不可见
- 租户状态控制（SUSPENDED时禁止访问）

#### 3.3.2 细粒度权限控制
- 资源级权限（NONE/VIEW/EDIT/MANAGE）
- 列级权限（HIDDEN/READONLY/READWRITE）
- 行级权限（基于JSON DSL的动态过滤）
- 权限继承（文件夹默认权限）

#### 3.3.3 LLM辅助编码生成
- 基于本地ollama自动生成表编码
- 基于本地ollama自动生成字段编码
- 智能命名规范化和唯一性校验

#### 3.3.4 统一过滤条件DSL
- 支持复杂条件组合（AND/OR嵌套）
- 支持多种操作符（=、!=、>、<、in、between、contains等）
- 支持特殊变量（CURRENT_USER、CURRENT_DATE、CURRENT_DATETIME）
- 应用于任务流过滤、数据集过滤、行权限、Widget查询

## 4. 非功能需求

### 4.1 性能要求

#### 4.1.1 响应时间
- **常规查询**：10万～百万级数据量，分页查询响应时间 < 2秒
- **看板加载**：单个看板包含10个以内Widget，整体加载时间 < 5秒
- **任务流执行**：同步返回启动结果，异步执行任务

#### 4.1.2 并发能力
- **QPS目标**：
  - 读操作：≥ 1000 QPS
  - 写操作：≥ 200 QPS
- **并发用户**：支持单租户内100+并发用户同时使用

#### 4.1.3 数据规模
- **单表数据量**：支持千万级数据（通过分页限制返回行数）
- **租户数量**：支持1000+租户
- **单租户表数量**：支持1000+表
- **任务流数量**：单租户支持100+任务流

### 4.2 可用性要求

#### 4.2.1 系统可用性
- **目标SLA**：99.5%（月度）
- **故障恢复时间**：< 4小时

#### 4.2.2 数据可靠性
- **数据备份**：每日自动备份
- **数据恢复**：支持按时间点恢复（RPO < 24小时）

### 4.3 安全性要求

#### 4.3.1 多租户隔离
- **数据隔离**：所有业务表必须包含`tenant_id`列
- **查询隔离**：所有查询/更新必须按`tenant_id`过滤
- **租户状态控制**：SUSPENDED租户禁止访问工作区

#### 4.3.2 权限控制
- **前端权限**：基于权限接口隐藏不可访问的功能
- **后端权限**：所有接口强制检查资源级权限
- **数据权限**：查询时自动应用行级/列级权限
- **按钮级权限**：操作按钮根据权限动态显示/隐藏

#### 4.3.3 认证与授权
- **登录认证**：支持用户名/密码登录
- **会话管理**：支持会话超时、强制下线
- **密码策略**：密码复杂度要求（后端实现）

### 4.4 可扩展性要求

#### 4.4.1 水平扩展
- **无状态设计**：支持多实例部署
- **数据库连接池**：支持连接池配置
- **缓存策略**：支持Redis缓存（可选）

#### 4.4.2 功能扩展
- **节点类型扩展**：支持自定义Source/Transform/Sink节点
- **Widget类型扩展**：支持自定义可视化组件
- **数据源扩展**：支持接入更多数据源类型

### 4.5 可维护性要求

#### 4.5.1 日志记录
- **操作日志**：记录建模变更（表/字段/关系增删改）
- **任务日志**：记录Flow配置变更、运行记录
- **权限日志**：记录权限变更行为
- **审计日志**：记录平台级关键操作

#### 4.5.2 监控与告警
- **系统监控**：CPU、内存、磁盘使用率
- **业务监控**：任务流执行成功率、失败率
- **告警机制**：关键错误自动告警

### 4.6 兼容性要求

#### 4.6.1 浏览器支持
- **生产环境**：支持现代浏览器（Chrome、Firefox、Safari、Edge最新2个版本）
- **本地开发**：推荐Chrome最新版
- **不支持**：IE浏览器、Chrome 80以下版本

#### 4.6.2 数据格式支持
- **文件导入**：支持CSV、Excel格式
- **API接口**：支持JSON格式
- **数据库**：支持MySQL（后续可扩展PostgreSQL等）

### 4.7 用户体验要求

#### 4.7.1 界面响应
- **页面加载**：首屏加载时间 < 3秒
- **操作反馈**：所有操作提供明确的成功/失败反馈
- **加载状态**：长时间操作显示加载进度

#### 4.7.2 错误处理
- **友好提示**：错误信息清晰易懂
- **操作指引**：关键操作提供引导提示
- **异常恢复**：支持重试机制

## 5. 项目目标

### 5.1 短期目标（V1.0）
- 完成平台后台核心功能（用户管理、租户管理）
- 完成租户工作区核心模块（建模、任务流、看板、设置）
- 实现基础的多租户隔离和权限控制
- 实现LLM辅助编码生成

### 5.2 中期目标（V2.0）
- 增强任务流能力（支持更多节点类型、错误重试机制）
- 增强看板能力（支持更多图表类型、交互式筛选）
- 性能优化（查询优化、缓存策略）
- 完善监控和告警体系

### 5.3 长期目标（V3.0+）
- 支持更多数据源（PostgreSQL、MongoDB、Kafka等）
- 支持实时数据流处理
- 支持数据质量检测和治理
- 支持AI辅助数据分析

